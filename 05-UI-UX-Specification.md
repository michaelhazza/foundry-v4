# UI/UX Specification: Foundry

**Generated by:** UI/UX Specification Agent v2.1  
**Date:** January 8, 2026  
**Status:** COMPLETE

**Source Documents:**
- PRD: 01-PRD.md (v1.0)
- Architecture: 02-Technical-Architecture.md (v1.0)
- API Contract: 04-API-Contract.md (v1.0)

---

## 1. Design System Foundation

### Breakpoints (Tailwind Defaults)

| Breakpoint | Width | Use Case |
|------------|-------|----------|
| sm | 640px | Small tablets |
| md | 768px | Minimum supported width (PRD requirement) |
| lg | 1024px | Laptops |
| xl | 1280px | Desktops |
| 2xl | 1536px | Large displays |

**Note:** Per PRD, minimum supported width is 768px. Desktop-first design; critical flows usable on tablet.

### Color Tokens (shadcn/ui CSS Variables)

```css
/* Light mode (default) - globals.css */
:root {
  --background: 0 0% 100%;
  --foreground: 222.2 84% 4.9%;
  --card: 0 0% 100%;
  --card-foreground: 222.2 84% 4.9%;
  --popover: 0 0% 100%;
  --popover-foreground: 222.2 84% 4.9%;
  --primary: 222.2 47.4% 11.2%;
  --primary-foreground: 210 40% 98%;
  --secondary: 210 40% 96.1%;
  --secondary-foreground: 222.2 47.4% 11.2%;
  --muted: 210 40% 96.1%;
  --muted-foreground: 215.4 16.3% 46.9%;
  --accent: 210 40% 96.1%;
  --accent-foreground: 222.2 47.4% 11.2%;
  --destructive: 0 84.2% 60.2%;
  --destructive-foreground: 210 40% 98%;
  --border: 214.3 31.8% 91.4%;
  --input: 214.3 31.8% 91.4%;
  --ring: 222.2 84% 4.9%;
  --radius: 0.5rem;
  
  /* Custom semantic colors */
  --success: 142 76% 36%;
  --success-foreground: 210 40% 98%;
  --warning: 38 92% 50%;
  --warning-foreground: 222.2 47.4% 11.2%;
}

/* Dark mode */
.dark {
  --background: 222.2 84% 4.9%;
  --foreground: 210 40% 98%;
  --card: 222.2 84% 4.9%;
  --card-foreground: 210 40% 98%;
  --popover: 222.2 84% 4.9%;
  --popover-foreground: 210 40% 98%;
  --primary: 210 40% 98%;
  --primary-foreground: 222.2 47.4% 11.2%;
  --secondary: 217.2 32.6% 17.5%;
  --secondary-foreground: 210 40% 98%;
  --muted: 217.2 32.6% 17.5%;
  --muted-foreground: 215 20.2% 65.1%;
  --accent: 217.2 32.6% 17.5%;
  --accent-foreground: 210 40% 98%;
  --destructive: 0 62.8% 30.6%;
  --destructive-foreground: 210 40% 98%;
  --border: 217.2 32.6% 17.5%;
  --input: 217.2 32.6% 17.5%;
  --ring: 212.7 26.8% 83.9%;
  
  --success: 142 76% 36%;
  --success-foreground: 210 40% 98%;
  --warning: 38 92% 50%;
  --warning-foreground: 222.2 47.4% 11.2%;
}
```

### Typography Scale

| Style | Tailwind Class | Size | Weight | Use Case |
|-------|---------------|------|--------|----------|
| Display | text-4xl font-bold | 36px | 700 | Page titles |
| Heading 1 | text-3xl font-semibold | 30px | 600 | Section headers |
| Heading 2 | text-2xl font-semibold | 24px | 600 | Subsection headers |
| Heading 3 | text-xl font-medium | 20px | 500 | Card titles |
| Body | text-base | 16px | 400 | Default text |
| Small | text-sm | 14px | 400 | Helper text, labels |
| Extra Small | text-xs | 12px | 400 | Badges, metadata |

### Spacing Scale (Tailwind)

| Token | Value | Use Case |
|-------|-------|----------|
| space-0.5 | 2px | Tight element grouping |
| space-1 | 4px | Icon spacing |
| space-2 | 8px | Small gaps |
| space-3 | 12px | Form field spacing |
| space-4 | 16px | Standard spacing |
| space-6 | 24px | Section spacing |
| space-8 | 32px | Card padding |
| space-12 | 48px | Large section gaps |
| space-16 | 64px | Page sections |

### Border Radius

| Token | Value | Use Case |
|-------|-------|----------|
| rounded-sm | calc(var(--radius) - 4px) | Badges, small elements |
| rounded-md | calc(var(--radius) - 2px) | Inputs, buttons |
| rounded-lg | var(--radius) | Cards, modals |
| rounded-xl | calc(var(--radius) + 4px) | Large containers |
| rounded-full | 9999px | Avatars, circular buttons |

### Accessibility Requirements

| Requirement | Target | Implementation |
|-------------|--------|----------------|
| Color contrast (normal) | 4.5:1 | Use semantic color tokens |
| Color contrast (large) | 3:1 | Large text 18px+ or 14px bold |
| Focus indicators | Visible | `ring-2 ring-ring ring-offset-2` |
| Keyboard navigation | Full support | Radix primitives handle this |
| Touch targets | 44x44px min | Mobile button minimums |
| Screen reader | ARIA labels | Required on icon-only buttons |

---

## 2. Component Library

### shadcn/ui Components Required

```bash
# Installation command
npx shadcn-ui@latest init

npx shadcn-ui@latest add button card dialog form input label select toast \
  alert-dialog dropdown-menu avatar badge skeleton tabs sheet separator \
  progress table tooltip popover checkbox radio-group switch textarea \
  alert scroll-area command
```

### Peer Dependencies

```bash
npm install @radix-ui/react-alert-dialog @radix-ui/react-dialog \
  @radix-ui/react-dropdown-menu @radix-ui/react-label @radix-ui/react-select \
  @radix-ui/react-slot @radix-ui/react-tabs @radix-ui/react-toast \
  @radix-ui/react-progress @radix-ui/react-checkbox @radix-ui/react-radio-group \
  @radix-ui/react-switch @radix-ui/react-popover @radix-ui/react-tooltip \
  @radix-ui/react-scroll-area
npm install lucide-react class-variance-authority clsx tailwind-merge
npm install react-dropzone date-fns
```

### cn() Utility (Required)

```typescript
// client/src/lib/utils.ts
import { type ClassValue, clsx } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

### Custom Component Extensions

#### FileUploadZone

```tsx
// client/src/components/file-upload-zone.tsx
interface FileUploadZoneProps {
  onFileSelect: (file: File) => void;
  accept?: Record<string, string[]>;
  maxSize?: number;
  isUploading?: boolean;
  uploadProgress?: number;
  error?: string;
}

// Accepts: CSV, Excel, JSON per PRD
// Max size: 50MB per PRD
// States: idle, dragActive, uploading, error
```

#### SourceCard

```tsx
// client/src/components/source-card.tsx
interface SourceCardProps {
  source: Source;
  onConfigure: () => void;
  onDelete: () => void;
  onTestConnection?: () => void;
}

// Displays source type icon, name, status, last sync
// Status badges: connected, syncing, error, pending
```

#### MappingTable

```tsx
// client/src/components/mapping-table.tsx
interface MappingTableProps {
  sourceFields: SourceField[];
  mappings: Mapping[];
  onMappingChange: (fieldId: string, targetField: string | null) => void;
}

// Auto-detected fields with confidence indicators
// Dropdown for target field selection
// Preview values column
```

#### ProcessingProgress

```tsx
// client/src/components/processing-progress.tsx
interface ProcessingProgressProps {
  job: ProcessingJob;
  onCancel?: () => void;
}

// Progress bar with percentage
// Records processed / total
// Estimated time remaining
// Cancel button (when running)
```

#### ExportFormatSelector

```tsx
// client/src/components/export-format-selector.tsx
interface ExportFormatSelectorProps {
  formats: ExportFormat[];
  selected: string;
  onSelect: (format: string) => void;
  options?: ExportOptions;
  onOptionsChange?: (options: ExportOptions) => void;
}

// Format options: Conversational JSONL, Q&A Pairs, Raw JSON
// Optional system prompt, context window settings
```

---

## 3. Navigation Structure

### Primary Navigation (Sidebar)

| Label | Route | Icon | Roles | Description |
|-------|-------|------|-------|-------------|
| Dashboard | /dashboard | LayoutDashboard | viewer, editor, admin | Overview and recent activity |
| Projects | /projects | FolderKanban | viewer, editor, admin | Project list and management |
| Team | /team | Users | admin | Team member management |
| Settings | /settings | Settings | viewer, editor, admin | Organization and account settings |
| Admin | /admin | Shield | platform_admin | Platform administration |

### User Menu (Header Dropdown)

| Label | Action | Roles |
|-------|--------|-------|
| My Account | Navigate to /settings/account | all |
| Log Out | POST /api/auth/logout → /login | all |

### Project-Level Navigation (Tabs)

| Label | Route | Icon | Description |
|-------|-------|------|-------------|
| Sources | /projects/:id/sources | Database | Data source management |
| Mapping | /projects/:id/mapping | ArrowRightLeft | Field mapping configuration |
| Processing | /projects/:id/processing | Cpu | Job execution and history |
| Exports | /projects/:id/exports | Download | Export generation and downloads |
| Settings | /projects/:id/settings | Settings | Project configuration |

### Settings Sub-Navigation

| Label | Route | Roles |
|-------|-------|-------|
| Organization | /settings/organization | admin |
| Account | /settings/account | all |
| Audit Log | /settings/audit | admin |

### Admin Sub-Navigation (Platform Admin Only)

| Label | Route |
|-------|-------|
| Organizations | /admin/organizations |
| System Health | /admin/health |

### Role-Based Navigation Gating

```tsx
// client/src/components/nav-sidebar.tsx
interface NavItem {
  label: string;
  href: string;
  icon: LucideIcon;
  roles: ('viewer' | 'editor' | 'admin' | 'platform_admin')[];
}

const navItems: NavItem[] = [
  { label: 'Dashboard', href: '/dashboard', icon: LayoutDashboard, roles: ['viewer', 'editor', 'admin'] },
  { label: 'Projects', href: '/projects', icon: FolderKanban, roles: ['viewer', 'editor', 'admin'] },
  { label: 'Team', href: '/team', icon: Users, roles: ['admin'] },
  { label: 'Settings', href: '/settings', icon: Settings, roles: ['viewer', 'editor', 'admin'] },
  { label: 'Admin', href: '/admin', icon: Shield, roles: ['platform_admin'] },
];

// Filter by user role
const visibleItems = navItems.filter(item => 
  item.roles.includes(user.role) || 
  (user.isPlatformAdmin && item.roles.includes('platform_admin'))
);
```

### Route Structure

```
/login                          # Public - Login page
/invite/:token                  # Public - Accept invitation
/reset-password/:token          # Public - Password reset
/forgot-password                # Public - Request password reset

/dashboard                      # Auth - Main dashboard
/projects                       # Auth - Project list
/projects/:id                   # Auth - Project detail (redirects to sources)
/projects/:id/sources           # Auth - Sources tab
/projects/:id/mapping           # Auth - Mapping tab
/projects/:id/processing        # Auth - Processing tab
/projects/:id/exports           # Auth - Exports tab
/projects/:id/settings          # Auth - Project settings

/team                           # Admin - Team members
/team/invite                    # Admin - Invite member

/settings                       # Auth - Settings (redirects to account)
/settings/organization          # Admin - Org settings
/settings/account               # Auth - Account settings
/settings/audit                 # Admin - Audit log

/admin                          # Platform - Admin (redirects to orgs)
/admin/organizations            # Platform - Organization list
/admin/organizations/:id        # Platform - Organization detail
/admin/health                   # Platform - System health
```

---

## 4. Screen Specifications

### 4.1 Authentication Screens

#### Login

**Route:** `/login`  
**Roles:** Public  
**Entry Points:** Direct navigation, redirect from protected routes, session expiry

**Data Requirements:** None (public)

**States:**

| State | Appearance |
|-------|------------|
| Default | Email and password inputs, "Log In" button, "Forgot password?" link |
| Submitting | Button shows loading spinner, inputs disabled |
| Error | Toast notification with error message |
| Rate Limited | Toast with countdown, button disabled |

**Layout:**

```tsx
<div className="min-h-screen flex items-center justify-center bg-muted/50">
  <Card className="w-full max-w-md">
    <CardHeader className="text-center">
      <div className="mx-auto mb-4">{/* Logo */}</div>
      <CardTitle className="text-2xl">Welcome to Foundry</CardTitle>
      <CardDescription>Sign in to your account</CardDescription>
    </CardHeader>
    <CardContent>
      <Form {...form}>
        {/* Email field */}
        {/* Password field */}
        <Button type="submit" className="w-full">Log In</Button>
      </Form>
      <div className="mt-4 text-center text-sm">
        <Link to="/forgot-password" className="text-primary hover:underline">
          Forgot your password?
        </Link>
      </div>
    </CardContent>
  </Card>
</div>
```

**Form Fields:**

| Field | Component | Validation | Error Message |
|-------|-----------|------------|---------------|
| email | Input type="email" | Required, email format | "Invalid email format" |
| password | Input type="password" | Required | "Password is required" |

**Error Handling:**

| Error Code | User Message | Recovery |
|------------|--------------|----------|
| INVALID_CREDENTIALS | "Invalid email or password" | Allow retry |
| RATE_LIMIT_EXCEEDED | "Too many attempts. Try again in {seconds}s" | Countdown timer |
| ORGANIZATION_DISABLED | "Your organization has been disabled" | Contact support link |

---

#### Accept Invitation

**Route:** `/invite/:token`  
**Roles:** Public  
**Entry Points:** Email invitation link

**Data Requirements:**

```typescript
// Validate token on page load
const { data: invitation, isLoading, error } = useQuery({
  queryKey: ['invitation', token],
  queryFn: () => api.get(`/api/invitations/${token}/validate`),
});
```

**States:**

| State | Appearance |
|-------|------------|
| Loading | Skeleton card |
| Invalid Token | Error message with "Request new invitation" guidance |
| Expired | "This invitation has expired" message |
| Valid | Name and password form |
| Submitting | Button loading, inputs disabled |

**Form Fields:**

| Field | Component | Validation | Error Message |
|-------|-----------|------------|---------------|
| name | Input | Required, max 255 | "Name is required" |
| password | Input type="password" | Min 8, uppercase, lowercase, number | See password rules |
| confirmPassword | Input type="password" | Must match password | "Passwords do not match" |

**Password Requirements Display:**

```tsx
<div className="text-sm text-muted-foreground space-y-1">
  <p className={cn(hasMinLength && "text-success")}>✓ At least 8 characters</p>
  <p className={cn(hasUppercase && "text-success")}>✓ One uppercase letter</p>
  <p className={cn(hasLowercase && "text-success")}>✓ One lowercase letter</p>
  <p className={cn(hasNumber && "text-success")}>✓ One number</p>
</div>
```

---

#### Forgot Password

**Route:** `/forgot-password`  
**Roles:** Public  

**States:**

| State | Appearance |
|-------|------------|
| Default | Email input, "Send Reset Link" button |
| Submitting | Button loading |
| Success | "Check your email" message (always shown, even if email doesn't exist) |
| Rate Limited | Toast with countdown |

---

#### Reset Password

**Route:** `/reset-password/:token`  
**Roles:** Public  

**States:**

| State | Appearance |
|-------|------------|
| Loading | Validating token skeleton |
| Invalid/Expired | Error message, link to request new reset |
| Valid | New password form |
| Success | Redirect to login with success toast |

---

### 4.2 Dashboard

**Route:** `/dashboard`  
**Roles:** viewer, editor, admin  
**Entry Points:** Post-login redirect, sidebar navigation

**Data Requirements:**

```typescript
const { data: stats } = useQuery({
  queryKey: ['dashboard-stats'],
  queryFn: () => api.get('/api/dashboard/stats'),
});

const { data: recentProjects } = useQuery({
  queryKey: ['projects', { limit: 5, sort: 'updatedAt' }],
  queryFn: () => api.get('/api/projects?limit=5&sort=updatedAt:desc'),
});

const { data: recentJobs } = useQuery({
  queryKey: ['recent-jobs'],
  queryFn: () => api.get('/api/jobs/recent'),
});
```

**States:**

| State | Appearance |
|-------|------------|
| Loading | Skeleton grid for stats, skeleton list for projects |
| Default | Stats cards, recent projects list, activity feed |
| Empty (New User) | Welcome message, "Create your first project" CTA |
| Error | Error alert with retry button |

**Layout:**

```tsx
<div className="container mx-auto p-6 space-y-6">
  {/* Page Header */}
  <div>
    <h1 className="text-3xl font-semibold">Dashboard</h1>
    <p className="text-muted-foreground">Welcome back, {user.name}</p>
  </div>

  {/* Stats Cards */}
  <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
    <StatsCard title="Total Projects" value={stats.projectCount} icon={FolderKanban} />
    <StatsCard title="Records Processed" value={stats.recordsProcessed} icon={Database} />
    <StatsCard title="Active Sources" value={stats.sourceCount} icon={Plug} />
    <StatsCard title="Exports Generated" value={stats.exportCount} icon={Download} />
  </div>

  {/* Recent Projects */}
  <Card>
    <CardHeader className="flex flex-row items-center justify-between">
      <CardTitle>Recent Projects</CardTitle>
      <Button variant="outline" size="sm" asChild>
        <Link to="/projects">View All</Link>
      </Button>
    </CardHeader>
    <CardContent>
      {/* Project list or empty state */}
    </CardContent>
  </Card>

  {/* Getting Started (for new users) */}
  {stats.projectCount === 0 && <GettingStartedCard />}
</div>
```

**Empty State (First-time User):**

```tsx
<Card className="flex flex-col items-center justify-center p-12 text-center">
  <div className="rounded-full bg-muted p-4 mb-4">
    <Sparkles className="h-8 w-8 text-muted-foreground" />
  </div>
  <CardTitle className="mb-2">Welcome to Foundry!</CardTitle>
  <CardDescription className="mb-6 max-w-md">
    Transform your business data into AI-ready training datasets. 
    Start by creating your first project.
  </CardDescription>
  <Button asChild>
    <Link to="/projects/new">
      <Plus className="mr-2 h-4 w-4" />
      Create Your First Project
    </Link>
  </Button>
</Card>
```

---

### 4.3 Projects

#### Project List

**Route:** `/projects`  
**Roles:** viewer, editor, admin  
**Entry Points:** Sidebar navigation, dashboard link

**Data Requirements:**

```typescript
const { data, isLoading, error } = useQuery({
  queryKey: ['projects', { page, search, status }],
  queryFn: () => api.get('/api/projects', { params: { page, search, status } }),
});
```

**States:**

| State | Appearance |
|-------|------------|
| Loading | Skeleton cards (6 items) |
| Default | Grid of project cards with pagination |
| Empty | "No projects yet" with CTA |
| Filtered Empty | "No projects match your filters" |
| Error | Error alert with retry |

**Layout:**

```tsx
<div className="container mx-auto p-6 space-y-6">
  {/* Header with actions */}
  <div className="flex items-center justify-between">
    <div>
      <h1 className="text-3xl font-semibold">Projects</h1>
      <p className="text-muted-foreground">Manage your data transformation projects</p>
    </div>
    {canCreate && (
      <Button asChild>
        <Link to="/projects/new">
          <Plus className="mr-2 h-4 w-4" />
          New Project
        </Link>
      </Button>
    )}
  </div>

  {/* Filters */}
  <div className="flex gap-4">
    <Input 
      placeholder="Search projects..." 
      className="max-w-sm"
      value={search}
      onChange={(e) => setSearch(e.target.value)}
    />
    <Select value={status} onValueChange={setStatus}>
      <SelectTrigger className="w-[180px]">
        <SelectValue placeholder="All statuses" />
      </SelectTrigger>
      <SelectContent>
        <SelectItem value="all">All statuses</SelectItem>
        <SelectItem value="active">Active</SelectItem>
        <SelectItem value="archived">Archived</SelectItem>
      </SelectContent>
    </Select>
  </div>

  {/* Project Grid */}
  <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-3">
    {projects.map(project => (
      <ProjectCard key={project.id} project={project} />
    ))}
  </div>

  {/* Pagination */}
  <Pagination {...pagination} />
</div>
```

**Project Card:**

```tsx
<Card className="hover:shadow-md transition-shadow">
  <CardHeader>
    <div className="flex items-start justify-between">
      <div>
        <CardTitle className="line-clamp-1">{project.name}</CardTitle>
        <CardDescription className="line-clamp-2">
          {project.description || "No description"}
        </CardDescription>
      </div>
      <ProjectStatusBadge status={project.status} />
    </div>
  </CardHeader>
  <CardContent>
    <div className="flex items-center gap-4 text-sm text-muted-foreground">
      <span className="flex items-center gap-1">
        <Database className="h-4 w-4" />
        {project.sourceCount} sources
      </span>
      <span className="flex items-center gap-1">
        <FileText className="h-4 w-4" />
        {project.recordCount} records
      </span>
    </div>
    <p className="text-xs text-muted-foreground mt-2">
      Updated {formatDistanceToNow(project.updatedAt)} ago
    </p>
  </CardContent>
  <CardFooter>
    <Button variant="ghost" className="w-full" asChild>
      <Link to={`/projects/${project.id}/sources`}>
        Open Project
        <ArrowRight className="ml-2 h-4 w-4" />
      </Link>
    </Button>
  </CardFooter>
</Card>
```

---

#### Create Project Dialog

**Route:** `/projects` (dialog overlay) or `/projects/new`  
**Roles:** editor, admin  

**Form Fields:**

| Field | Component | Validation | Default |
|-------|-----------|------------|---------|
| name | Input | Required, max 100 chars | "" |
| description | Textarea | Optional, max 1000 chars | "" |

**Submission:**

- Success: Toast "Project created", redirect to `/projects/:id/sources`
- Error: Display validation errors or toast

---

#### Project Detail - Sources Tab

**Route:** `/projects/:id/sources`  
**Roles:** viewer, editor, admin  
**Entry Points:** Project navigation, dashboard project click

**Data Requirements:**

```typescript
const { data: project } = useQuery({
  queryKey: ['project', projectId],
  queryFn: () => api.get(`/api/projects/${projectId}`),
});

const { data: sources } = useQuery({
  queryKey: ['sources', projectId],
  queryFn: () => api.get(`/api/projects/${projectId}/sources`),
});
```

**States:**

| State | Appearance |
|-------|------------|
| Loading | Skeleton cards |
| Default | Source cards with status |
| Empty | "Add your first data source" CTA |
| Error | Error alert with retry |

**Layout:**

```tsx
<div className="space-y-6">
  {/* Project Header with Tabs */}
  <ProjectHeader project={project} />
  <ProjectTabs activeTab="sources" projectId={projectId} />

  {/* Content */}
  <div className="space-y-4">
    {/* Add Source Button */}
    {canEdit && (
      <div className="flex justify-end">
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <Button>
              <Plus className="mr-2 h-4 w-4" />
              Add Source
            </Button>
          </DropdownMenuTrigger>
          <DropdownMenuContent>
            <DropdownMenuItem onClick={() => setShowUploadDialog(true)}>
              <Upload className="mr-2 h-4 w-4" />
              Upload File
            </DropdownMenuItem>
            <DropdownMenuItem onClick={() => setShowTeamworkDialog(true)}>
              <Plug className="mr-2 h-4 w-4" />
              Connect Teamwork Desk
            </DropdownMenuItem>
            <DropdownMenuItem onClick={() => setShowGHLDialog(true)}>
              <Plug className="mr-2 h-4 w-4" />
              Connect GoHighLevel
            </DropdownMenuItem>
          </DropdownMenuContent>
        </DropdownMenu>
      </div>
    )}

    {/* Source Cards */}
    {sources.length === 0 ? (
      <EmptySourceState onAddSource={() => setShowUploadDialog(true)} />
    ) : (
      <div className="grid gap-4 md:grid-cols-2">
        {sources.map(source => (
          <SourceCard 
            key={source.id} 
            source={source}
            onConfigure={() => openSourceConfig(source)}
            onDelete={() => confirmDeleteSource(source)}
            onTestConnection={() => testConnection(source)}
          />
        ))}
      </div>
    )}
  </div>
</div>
```

**File Upload Dialog:**

```tsx
<Dialog open={showUploadDialog} onOpenChange={setShowUploadDialog}>
  <DialogContent className="sm:max-w-lg">
    <DialogHeader>
      <DialogTitle>Upload File</DialogTitle>
      <DialogDescription>
        Upload a CSV, Excel, or JSON file (max 50MB)
      </DialogDescription>
    </DialogHeader>
    
    <FileUploadZone
      accept={{
        'text/csv': ['.csv'],
        'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': ['.xlsx'],
        'application/vnd.ms-excel': ['.xls'],
        'application/json': ['.json'],
      }}
      maxSize={50 * 1024 * 1024}
      onFileSelect={handleFileSelect}
      isUploading={isUploading}
      uploadProgress={uploadProgress}
      error={uploadError}
    />

    <DialogFooter>
      <Button variant="outline" onClick={() => setShowUploadDialog(false)}>
        Cancel
      </Button>
    </DialogFooter>
  </DialogContent>
</Dialog>
```

**Teamwork Desk Connection Dialog:**

```tsx
<Dialog open={showTeamworkDialog} onOpenChange={setShowTeamworkDialog}>
  <DialogContent className="sm:max-w-md">
    <DialogHeader>
      <DialogTitle>Connect Teamwork Desk</DialogTitle>
      <DialogDescription>
        Import support tickets from your Teamwork Desk account
      </DialogDescription>
    </DialogHeader>
    
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        <FormField
          control={form.control}
          name="name"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Source Name</FormLabel>
              <FormControl>
                <Input placeholder="e.g., Support Tickets" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        
        <FormField
          control={form.control}
          name="subdomain"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Teamwork Subdomain</FormLabel>
              <FormControl>
                <div className="flex">
                  <Input placeholder="yourcompany" {...field} />
                  <span className="flex items-center px-3 bg-muted border border-l-0 rounded-r-md text-sm text-muted-foreground">
                    .teamwork.com
                  </span>
                </div>
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        
        <FormField
          control={form.control}
          name="apiKey"
          render={({ field }) => (
            <FormItem>
              <FormLabel>API Key</FormLabel>
              <FormControl>
                <Input type="password" {...field} />
              </FormControl>
              <FormDescription>
                Find this in Teamwork Settings → API & Integrations
              </FormDescription>
              <FormMessage />
            </FormItem>
          )}
        />

        <div className="flex gap-2">
          <Button 
            type="button" 
            variant="outline"
            onClick={handleTestConnection}
            disabled={isTestingConnection}
          >
            {isTestingConnection ? (
              <Loader2 className="mr-2 h-4 w-4 animate-spin" />
            ) : (
              <Check className="mr-2 h-4 w-4" />
            )}
            Test Connection
          </Button>
        </div>

        <DialogFooter>
          <Button variant="outline" onClick={() => setShowTeamworkDialog(false)}>
            Cancel
          </Button>
          <Button type="submit" disabled={!connectionTested || isSubmitting}>
            {isSubmitting && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            Connect
          </Button>
        </DialogFooter>
      </form>
    </Form>
  </DialogContent>
</Dialog>
```

---

#### Project Detail - Mapping Tab

**Route:** `/projects/:id/mapping`  
**Roles:** viewer, editor, admin  

**Data Requirements:**

```typescript
const { data: sources } = useQuery({
  queryKey: ['sources', projectId],
  queryFn: () => api.get(`/api/projects/${projectId}/sources`),
});

const { data: mappings, isLoading: mappingsLoading } = useQuery({
  queryKey: ['mappings', sourceId],
  queryFn: () => api.get(`/api/sources/${sourceId}/mappings`),
  enabled: !!sourceId,
});
```

**States:**

| State | Appearance |
|-------|------------|
| No Sources | "Add a source first" message |
| Loading | Skeleton table |
| Default | Mapping table with dropdowns |
| Preview Mode | Side panel with sample data |

**Layout:**

```tsx
<div className="space-y-6">
  <ProjectHeader project={project} />
  <ProjectTabs activeTab="mapping" projectId={projectId} />

  {sources.length === 0 ? (
    <Card className="p-12 text-center">
      <p className="text-muted-foreground mb-4">
        Add a data source before configuring mappings
      </p>
      <Button asChild>
        <Link to={`/projects/${projectId}/sources`}>Add Source</Link>
      </Button>
    </Card>
  ) : (
    <div className="space-y-4">
      {/* Source Selector */}
      <div className="flex items-center gap-4">
        <Label>Source:</Label>
        <Select value={sourceId} onValueChange={setSourceId}>
          <SelectTrigger className="w-[300px]">
            <SelectValue placeholder="Select a source" />
          </SelectTrigger>
          <SelectContent>
            {sources.map(source => (
              <SelectItem key={source.id} value={source.id.toString()}>
                {source.name}
              </SelectItem>
            ))}
          </SelectContent>
        </Select>
        
        {canEdit && (
          <Button 
            variant="outline"
            onClick={handleAutoDetect}
            disabled={isAutoDetecting}
          >
            {isAutoDetecting && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            <Wand2 className="mr-2 h-4 w-4" />
            Auto-Detect
          </Button>
        )}
      </div>

      {/* Mapping Table */}
      <Card>
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>Source Field</TableHead>
              <TableHead>Sample Value</TableHead>
              <TableHead>Confidence</TableHead>
              <TableHead>Target Field</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {mappings.map(mapping => (
              <TableRow key={mapping.sourceField}>
                <TableCell className="font-medium">{mapping.sourceField}</TableCell>
                <TableCell className="text-muted-foreground max-w-[200px] truncate">
                  {mapping.sampleValue}
                </TableCell>
                <TableCell>
                  <ConfidenceBadge confidence={mapping.confidence} />
                </TableCell>
                <TableCell>
                  <Select 
                    value={mapping.targetField || ''} 
                    onValueChange={(v) => handleMappingChange(mapping.sourceField, v)}
                    disabled={!canEdit}
                  >
                    <SelectTrigger className="w-[200px]">
                      <SelectValue placeholder="Select mapping" />
                    </SelectTrigger>
                    <SelectContent>
                      <SelectItem value="">— Not mapped —</SelectItem>
                      {targetFields.map(field => (
                        <SelectItem key={field.id} value={field.id}>
                          {field.label}
                        </SelectItem>
                      ))}
                    </SelectContent>
                  </Select>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </Card>

      {/* Preview Button */}
      <div className="flex justify-end gap-2">
        <Button variant="outline" onClick={() => setShowPreview(true)}>
          <Eye className="mr-2 h-4 w-4" />
          Preview
        </Button>
        {canEdit && (
          <Button onClick={handleSave} disabled={isSaving}>
            {isSaving && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            Save Mappings
          </Button>
        )}
      </div>
    </div>
  )}
</div>
```

**Confidence Badge:**

```tsx
function ConfidenceBadge({ confidence }: { confidence: 'high' | 'medium' | 'low' }) {
  const variants = {
    high: 'bg-success/10 text-success',
    medium: 'bg-warning/10 text-warning',
    low: 'bg-muted text-muted-foreground',
  };
  
  return (
    <Badge variant="outline" className={cn(variants[confidence])}>
      {confidence}
    </Badge>
  );
}
```

**Preview Sheet:**

```tsx
<Sheet open={showPreview} onOpenChange={setShowPreview}>
  <SheetContent className="w-[600px] sm:max-w-[600px]">
    <SheetHeader>
      <SheetTitle>Mapping Preview</SheetTitle>
      <SheetDescription>
        Sample of 10 records with current mappings applied
      </SheetDescription>
    </SheetHeader>
    
    <div className="mt-6">
      <Table>
        <TableHeader>
          <TableRow>
            {previewFields.map(field => (
              <TableHead key={field}>{field}</TableHead>
            ))}
          </TableRow>
        </TableHeader>
        <TableBody>
          {previewData.map((row, i) => (
            <TableRow key={i}>
              {previewFields.map(field => (
                <TableCell key={field} className="max-w-[150px] truncate">
                  {row[field]}
                </TableCell>
              ))}
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </div>
  </SheetContent>
</Sheet>
```

---

#### Project Detail - Processing Tab

**Route:** `/projects/:id/processing`  
**Roles:** viewer, editor, admin  

**Data Requirements:**

```typescript
const { data: jobs, isLoading } = useQuery({
  queryKey: ['jobs', projectId],
  queryFn: () => api.get(`/api/projects/${projectId}/jobs`),
  refetchInterval: (data) => 
    data?.some(job => job.status === 'running') ? 2000 : false,
});

const { data: project } = useQuery({
  queryKey: ['project', projectId],
  queryFn: () => api.get(`/api/projects/${projectId}`),
});
```

**States:**

| State | Appearance |
|-------|------------|
| Loading | Skeleton list |
| No Jobs | "Run your first processing job" CTA |
| Running Job | Progress bar with stats, cancel button |
| Job History | List of past jobs with status badges |

**Layout:**

```tsx
<div className="space-y-6">
  <ProjectHeader project={project} />
  <ProjectTabs activeTab="processing" projectId={projectId} />

  <div className="space-y-6">
    {/* Run Processing Card */}
    <Card>
      <CardHeader>
        <CardTitle>Run Processing</CardTitle>
        <CardDescription>
          Apply mappings, de-identification, and quality filters to your data
        </CardDescription>
      </CardHeader>
      <CardContent>
        {runningJob ? (
          <ProcessingProgress job={runningJob} onCancel={handleCancel} />
        ) : (
          <div className="flex items-center justify-between">
            <div className="space-y-1">
              <p className="text-sm">
                <span className="font-medium">{project.sourceCount}</span> sources configured
              </p>
              <p className="text-sm">
                <span className="font-medium">{project.totalRecords}</span> records to process
              </p>
            </div>
            {canEdit && (
              <Button onClick={handleStartProcessing} disabled={isStarting}>
                {isStarting && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
                <Play className="mr-2 h-4 w-4" />
                Run Processing
              </Button>
            )}
          </div>
        )}
      </CardContent>
    </Card>

    {/* Processing History */}
    <Card>
      <CardHeader>
        <CardTitle>Processing History</CardTitle>
      </CardHeader>
      <CardContent>
        {jobs.length === 0 ? (
          <p className="text-muted-foreground text-center py-8">
            No processing jobs yet
          </p>
        ) : (
          <Table>
            <TableHeader>
              <TableRow>
                <TableHead>Started</TableHead>
                <TableHead>Duration</TableHead>
                <TableHead>Records</TableHead>
                <TableHead>Status</TableHead>
                <TableHead></TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              {jobs.map(job => (
                <TableRow key={job.id}>
                  <TableCell>{formatDateTime(job.startedAt)}</TableCell>
                  <TableCell>{formatDuration(job.duration)}</TableCell>
                  <TableCell>{job.recordsProcessed} / {job.recordsTotal}</TableCell>
                  <TableCell>
                    <JobStatusBadge status={job.status} />
                  </TableCell>
                  <TableCell>
                    <Button variant="ghost" size="sm" onClick={() => viewJobDetails(job)}>
                      View Details
                    </Button>
                  </TableCell>
                </TableRow>
              ))}
            </TableBody>
          </Table>
        )}
      </CardContent>
    </Card>
  </div>
</div>
```

**ProcessingProgress Component:**

```tsx
function ProcessingProgress({ job, onCancel }: ProcessingProgressProps) {
  const percentage = Math.round((job.recordsProcessed / job.recordsTotal) * 100);
  
  return (
    <div className="space-y-4">
      <div className="flex items-center justify-between">
        <div className="flex items-center gap-2">
          <Loader2 className="h-4 w-4 animate-spin text-primary" />
          <span className="font-medium">Processing...</span>
        </div>
        <Button variant="outline" size="sm" onClick={onCancel}>
          <X className="mr-2 h-4 w-4" />
          Cancel
        </Button>
      </div>
      
      <Progress value={percentage} className="h-2" />
      
      <div className="flex justify-between text-sm text-muted-foreground">
        <span>{job.recordsProcessed.toLocaleString()} / {job.recordsTotal.toLocaleString()} records</span>
        <span>{percentage}%</span>
      </div>
      
      {job.estimatedTimeRemaining && (
        <p className="text-sm text-muted-foreground">
          Estimated time remaining: {formatDuration(job.estimatedTimeRemaining)}
        </p>
      )}
    </div>
  );
}
```

**Job Status Badge:**

```tsx
function JobStatusBadge({ status }: { status: JobStatus }) {
  const variants = {
    pending: { variant: 'outline', icon: Clock },
    running: { variant: 'default', icon: Loader2, animate: true },
    completed: { variant: 'success', icon: CheckCircle },
    failed: { variant: 'destructive', icon: XCircle },
    cancelled: { variant: 'secondary', icon: Ban },
  };
  
  const config = variants[status];
  const Icon = config.icon;
  
  return (
    <Badge variant={config.variant}>
      <Icon className={cn("mr-1 h-3 w-3", config.animate && "animate-spin")} />
      {status}
    </Badge>
  );
}
```

---

#### Project Detail - Exports Tab

**Route:** `/projects/:id/exports`  
**Roles:** viewer, editor, admin  

**Data Requirements:**

```typescript
const { data: exports } = useQuery({
  queryKey: ['exports', projectId],
  queryFn: () => api.get(`/api/projects/${projectId}/exports`),
});

const { data: latestJob } = useQuery({
  queryKey: ['latest-job', projectId],
  queryFn: () => api.get(`/api/projects/${projectId}/jobs/latest`),
});
```

**States:**

| State | Appearance |
|-------|------------|
| No Completed Jobs | "Run processing first" message |
| Loading | Skeleton list |
| Default | Export format selector, export history list |
| Generating | Progress indicator |

**Layout:**

```tsx
<div className="space-y-6">
  <ProjectHeader project={project} />
  <ProjectTabs activeTab="exports" projectId={projectId} />

  {!hasCompletedJob ? (
    <Card className="p-12 text-center">
      <p className="text-muted-foreground mb-4">
        Run processing before generating exports
      </p>
      <Button asChild>
        <Link to={`/projects/${projectId}/processing`}>Go to Processing</Link>
      </Button>
    </Card>
  ) : (
    <div className="space-y-6">
      {/* Generate Export Card */}
      <Card>
        <CardHeader>
          <CardTitle>Generate Export</CardTitle>
          <CardDescription>
            Export your processed data in AI training formats
          </CardDescription>
        </CardHeader>
        <CardContent className="space-y-4">
          <ExportFormatSelector
            formats={[
              { id: 'conversational_jsonl', label: 'Conversational JSONL', description: 'OpenAI-compatible chat format' },
              { id: 'qa_pairs', label: 'Q&A Pairs', description: 'Question and answer format' },
              { id: 'raw_json', label: 'Raw JSON', description: 'All fields as structured JSON' },
            ]}
            selected={selectedFormat}
            onSelect={setSelectedFormat}
          />
          
          {selectedFormat === 'conversational_jsonl' && (
            <FormField
              control={form.control}
              name="systemPrompt"
              render={({ field }) => (
                <FormItem>
                  <FormLabel>System Prompt (Optional)</FormLabel>
                  <FormControl>
                    <Textarea 
                      placeholder="You are a helpful customer support agent..."
                      {...field}
                    />
                  </FormControl>
                  <FormDescription>
                    Prepended to each conversation as the system message
                  </FormDescription>
                </FormItem>
              )}
            />
          )}
          
          <Button onClick={handleGenerateExport} disabled={isGenerating}>
            {isGenerating && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            <Download className="mr-2 h-4 w-4" />
            Generate Export
          </Button>
        </CardContent>
      </Card>

      {/* Export History */}
      <Card>
        <CardHeader>
          <CardTitle>Export History</CardTitle>
          <CardDescription>
            Downloads available for 30 days
          </CardDescription>
        </CardHeader>
        <CardContent>
          <Table>
            <TableHeader>
              <TableRow>
                <TableHead>Created</TableHead>
                <TableHead>Format</TableHead>
                <TableHead>Records</TableHead>
                <TableHead>Size</TableHead>
                <TableHead>Expires</TableHead>
                <TableHead></TableHead>
              </TableRow>
            </TableHeader>
            <TableBody>
              {exports.map(exp => (
                <TableRow key={exp.id}>
                  <TableCell>{formatDateTime(exp.createdAt)}</TableCell>
                  <TableCell>
                    <Badge variant="outline">{exp.format}</Badge>
                  </TableCell>
                  <TableCell>{exp.recordCount.toLocaleString()}</TableCell>
                  <TableCell>{formatBytes(exp.fileSize)}</TableCell>
                  <TableCell>{formatDate(exp.expiresAt)}</TableCell>
                  <TableCell>
                    {exp.expired ? (
                      <Badge variant="secondary">Expired</Badge>
                    ) : (
                      <Button variant="ghost" size="sm" asChild>
                        <a href={`/api/exports/${exp.id}/download`} download>
                          <Download className="mr-2 h-4 w-4" />
                          Download
                        </a>
                      </Button>
                    )}
                  </TableCell>
                </TableRow>
              ))}
            </TableBody>
          </Table>
        </CardContent>
      </Card>
    </div>
  )}
</div>
```

---

### 4.4 Team Management

#### Team List

**Route:** `/team`  
**Roles:** admin  
**Entry Points:** Sidebar navigation

**Data Requirements:**

```typescript
const { data: members } = useQuery({
  queryKey: ['team'],
  queryFn: () => api.get('/api/team'),
});

const { data: invitations } = useQuery({
  queryKey: ['invitations'],
  queryFn: () => api.get('/api/invitations'),
});
```

**States:**

| State | Appearance |
|-------|------------|
| Loading | Skeleton table |
| Default | Member table with role badges |
| With Pending | Separate section for pending invitations |

**Layout:**

```tsx
<div className="container mx-auto p-6 space-y-6">
  <div className="flex items-center justify-between">
    <div>
      <h1 className="text-3xl font-semibold">Team</h1>
      <p className="text-muted-foreground">Manage team members and invitations</p>
    </div>
    <Button onClick={() => setShowInviteDialog(true)}>
      <UserPlus className="mr-2 h-4 w-4" />
      Invite Member
    </Button>
  </div>

  {/* Active Members */}
  <Card>
    <CardHeader>
      <CardTitle>Team Members</CardTitle>
    </CardHeader>
    <CardContent>
      <Table>
        <TableHeader>
          <TableRow>
            <TableHead>Member</TableHead>
            <TableHead>Role</TableHead>
            <TableHead>Joined</TableHead>
            <TableHead></TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {members.map(member => (
            <TableRow key={member.id}>
              <TableCell>
                <div className="flex items-center gap-3">
                  <Avatar>
                    <AvatarFallback>{getInitials(member.name)}</AvatarFallback>
                  </Avatar>
                  <div>
                    <p className="font-medium">{member.name}</p>
                    <p className="text-sm text-muted-foreground">{member.email}</p>
                  </div>
                </div>
              </TableCell>
              <TableCell>
                <RoleBadge role={member.role} />
              </TableCell>
              <TableCell>{formatDate(member.joinedAt)}</TableCell>
              <TableCell>
                {member.id !== currentUser.id && (
                  <DropdownMenu>
                    <DropdownMenuTrigger asChild>
                      <Button variant="ghost" size="sm">
                        <MoreHorizontal className="h-4 w-4" />
                      </Button>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent>
                      <DropdownMenuItem onClick={() => openRoleDialog(member)}>
                        Change Role
                      </DropdownMenuItem>
                      <DropdownMenuSeparator />
                      <DropdownMenuItem 
                        className="text-destructive"
                        onClick={() => confirmRemoveMember(member)}
                      >
                        Remove Member
                      </DropdownMenuItem>
                    </DropdownMenuContent>
                  </DropdownMenu>
                )}
              </TableCell>
            </TableRow>
          ))}
        </TableBody>
      </Table>
    </CardContent>
  </Card>

  {/* Pending Invitations */}
  {invitations.length > 0 && (
    <Card>
      <CardHeader>
        <CardTitle>Pending Invitations</CardTitle>
      </CardHeader>
      <CardContent>
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>Email</TableHead>
              <TableHead>Role</TableHead>
              <TableHead>Sent</TableHead>
              <TableHead>Expires</TableHead>
              <TableHead></TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {invitations.map(inv => (
              <TableRow key={inv.id}>
                <TableCell>{inv.email}</TableCell>
                <TableCell><RoleBadge role={inv.role} /></TableCell>
                <TableCell>{formatDate(inv.createdAt)}</TableCell>
                <TableCell>{formatDate(inv.expiresAt)}</TableCell>
                <TableCell>
                  <Button 
                    variant="ghost" 
                    size="sm"
                    onClick={() => cancelInvitation(inv.id)}
                  >
                    Cancel
                  </Button>
                </TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </CardContent>
    </Card>
  )}
</div>
```

**Invite Member Dialog:**

```tsx
<Dialog open={showInviteDialog} onOpenChange={setShowInviteDialog}>
  <DialogContent>
    <DialogHeader>
      <DialogTitle>Invite Team Member</DialogTitle>
      <DialogDescription>
        Send an invitation to join your organization
      </DialogDescription>
    </DialogHeader>
    
    <Form {...form}>
      <form onSubmit={form.handleSubmit(onSubmit)} className="space-y-4">
        <FormField
          control={form.control}
          name="email"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Email Address</FormLabel>
              <FormControl>
                <Input type="email" placeholder="colleague@company.com" {...field} />
              </FormControl>
              <FormMessage />
            </FormItem>
          )}
        />
        
        <FormField
          control={form.control}
          name="role"
          render={({ field }) => (
            <FormItem>
              <FormLabel>Role</FormLabel>
              <Select onValueChange={field.onChange} defaultValue={field.value}>
                <FormControl>
                  <SelectTrigger>
                    <SelectValue placeholder="Select a role" />
                  </SelectTrigger>
                </FormControl>
                <SelectContent>
                  <SelectItem value="viewer">
                    <div>
                      <p className="font-medium">Viewer</p>
                      <p className="text-xs text-muted-foreground">Can view projects and download exports</p>
                    </div>
                  </SelectItem>
                  <SelectItem value="editor">
                    <div>
                      <p className="font-medium">Editor</p>
                      <p className="text-xs text-muted-foreground">Can create and edit projects</p>
                    </div>
                  </SelectItem>
                  <SelectItem value="admin">
                    <div>
                      <p className="font-medium">Admin</p>
                      <p className="text-xs text-muted-foreground">Full access including team management</p>
                    </div>
                  </SelectItem>
                </SelectContent>
              </Select>
              <FormMessage />
            </FormItem>
          )}
        />

        <DialogFooter>
          <Button variant="outline" onClick={() => setShowInviteDialog(false)}>
            Cancel
          </Button>
          <Button type="submit" disabled={isSubmitting}>
            {isSubmitting && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
            Send Invitation
          </Button>
        </DialogFooter>
      </form>
    </Form>
  </DialogContent>
</Dialog>
```

---

### 4.5 Settings

#### Audit Log

**Route:** `/settings/audit`  
**Roles:** admin  

**Data Requirements:**

```typescript
const { data: logs, isLoading } = useQuery({
  queryKey: ['audit-logs', { page, dateRange, userId, actionType }],
  queryFn: () => api.get('/api/audit-logs', { params: filters }),
});
```

**States:**

| State | Appearance |
|-------|------------|
| Loading | Skeleton table |
| Default | Filterable audit log table with pagination |
| Empty | "No audit events" message |
| Exporting | Export button shows loading |

**Layout:**

```tsx
<div className="container mx-auto p-6 space-y-6">
  <div className="flex items-center justify-between">
    <div>
      <h1 className="text-3xl font-semibold">Audit Log</h1>
      <p className="text-muted-foreground">Review activity and changes</p>
    </div>
    <Button variant="outline" onClick={handleExport} disabled={isExporting}>
      {isExporting && <Loader2 className="mr-2 h-4 w-4 animate-spin" />}
      <Download className="mr-2 h-4 w-4" />
      Export CSV
    </Button>
  </div>

  {/* Filters */}
  <Card>
    <CardContent className="pt-6">
      <div className="flex flex-wrap gap-4">
        <div className="flex items-center gap-2">
          <Label>Date Range:</Label>
          <DateRangePicker
            value={dateRange}
            onChange={setDateRange}
          />
        </div>
        <div className="flex items-center gap-2">
          <Label>User:</Label>
          <Select value={userId} onValueChange={setUserId}>
            <SelectTrigger className="w-[200px]">
              <SelectValue placeholder="All users" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="">All users</SelectItem>
              {users.map(user => (
                <SelectItem key={user.id} value={user.id.toString()}>
                  {user.name}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>
        <div className="flex items-center gap-2">
          <Label>Action:</Label>
          <Select value={actionType} onValueChange={setActionType}>
            <SelectTrigger className="w-[200px]">
              <SelectValue placeholder="All actions" />
            </SelectTrigger>
            <SelectContent>
              <SelectItem value="">All actions</SelectItem>
              <SelectItem value="auth">Authentication</SelectItem>
              <SelectItem value="project">Projects</SelectItem>
              <SelectItem value="processing">Processing</SelectItem>
              <SelectItem value="export">Exports</SelectItem>
              <SelectItem value="team">Team</SelectItem>
            </SelectContent>
          </Select>
        </div>
      </div>
    </CardContent>
  </Card>

  {/* Audit Log Table */}
  <Card>
    <Table>
      <TableHeader>
        <TableRow>
          <TableHead>Timestamp</TableHead>
          <TableHead>User</TableHead>
          <TableHead>Action</TableHead>
          <TableHead>Resource</TableHead>
          <TableHead>Details</TableHead>
        </TableRow>
      </TableHeader>
      <TableBody>
        {logs.items.map(log => (
          <TableRow key={log.id}>
            <TableCell className="whitespace-nowrap">
              {formatDateTime(log.timestamp)}
            </TableCell>
            <TableCell>
              <div className="flex items-center gap-2">
                <Avatar className="h-6 w-6">
                  <AvatarFallback className="text-xs">
                    {getInitials(log.userName)}
                  </AvatarFallback>
                </Avatar>
                <span>{log.userName}</span>
              </div>
            </TableCell>
            <TableCell>
              <Badge variant="outline">{log.action}</Badge>
            </TableCell>
            <TableCell>{log.resourceType} #{log.resourceId}</TableCell>
            <TableCell className="max-w-[300px]">
              <Popover>
                <PopoverTrigger asChild>
                  <Button variant="ghost" size="sm">
                    View Details
                  </Button>
                </PopoverTrigger>
                <PopoverContent className="w-[400px]">
                  <pre className="text-xs overflow-auto max-h-[200px]">
                    {JSON.stringify(log.details, null, 2)}
                  </pre>
                </PopoverContent>
              </Popover>
            </TableCell>
          </TableRow>
        ))}
      </TableBody>
    </Table>
    <div className="p-4 border-t">
      <Pagination {...logs.pagination} />
    </div>
  </Card>
</div>
```

---

### 4.6 Platform Administration

#### Organization List (Platform Admin)

**Route:** `/admin/organizations`  
**Roles:** platform_admin  

**Data Requirements:**

```typescript
const { data: orgs, isLoading } = useQuery({
  queryKey: ['admin-organizations', { page, search }],
  queryFn: () => api.get('/api/admin/organizations', { params: { page, search } }),
});
```

**Layout:**

```tsx
<div className="container mx-auto p-6 space-y-6">
  <div className="flex items-center justify-between">
    <div>
      <h1 className="text-3xl font-semibold">Organizations</h1>
      <p className="text-muted-foreground">Manage platform tenants</p>
    </div>
    <Button onClick={() => setShowCreateDialog(true)}>
      <Plus className="mr-2 h-4 w-4" />
      Create Organization
    </Button>
  </div>

  {/* Search */}
  <div className="flex gap-4">
    <Input 
      placeholder="Search organizations..." 
      className="max-w-sm"
      value={search}
      onChange={(e) => setSearch(e.target.value)}
    />
  </div>

  {/* Organizations Table */}
  <Card>
    <Table>
      <TableHeader>
        <TableRow>
          <TableHead>Organization</TableHead>
          <TableHead>Users</TableHead>
          <TableHead>Projects</TableHead>
          <TableHead>Last Activity</TableHead>
          <TableHead>Status</TableHead>
          <TableHead></TableHead>
        </TableRow>
      </TableHeader>
      <TableBody>
        {orgs.items.map(org => (
          <TableRow key={org.id}>
            <TableCell className="font-medium">{org.name}</TableCell>
            <TableCell>{org.userCount}</TableCell>
            <TableCell>{org.projectCount}</TableCell>
            <TableCell>{formatDistanceToNow(org.lastActivity)} ago</TableCell>
            <TableCell>
              <Badge variant={org.disabled ? 'destructive' : 'success'}>
                {org.disabled ? 'Disabled' : 'Active'}
              </Badge>
            </TableCell>
            <TableCell>
              <DropdownMenu>
                <DropdownMenuTrigger asChild>
                  <Button variant="ghost" size="sm">
                    <MoreHorizontal className="h-4 w-4" />
                  </Button>
                </DropdownMenuTrigger>
                <DropdownMenuContent>
                  <DropdownMenuItem onClick={() => viewOrgDetails(org)}>
                    View Details
                  </DropdownMenuItem>
                  <DropdownMenuSeparator />
                  {org.disabled ? (
                    <DropdownMenuItem onClick={() => enableOrg(org.id)}>
                      Enable Organization
                    </DropdownMenuItem>
                  ) : (
                    <DropdownMenuItem 
                      className="text-destructive"
                      onClick={() => confirmDisableOrg(org)}
                    >
                      Disable Organization
                    </DropdownMenuItem>
                  )}
                </DropdownMenuContent>
              </DropdownMenu>
            </TableCell>
          </TableRow>
        ))}
      </TableBody>
    </Table>
    <div className="p-4 border-t">
      <Pagination {...orgs.pagination} />
    </div>
  </Card>
</div>
```

#### System Health (Platform Admin)

**Route:** `/admin/health`  
**Roles:** platform_admin  

**Data Requirements:**

```typescript
const { data: health, isLoading, error } = useQuery({
  queryKey: ['admin-health'],
  queryFn: () => api.get('/api/admin/health'),
  refetchInterval: 60000, // Refresh every 60s
});
```

**Layout:**

```tsx
<div className="container mx-auto p-6 space-y-6">
  <div>
    <h1 className="text-3xl font-semibold">System Health</h1>
    <p className="text-muted-foreground">Platform monitoring and metrics</p>
  </div>

  {/* Status Cards */}
  <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
    <Card>
      <CardHeader className="pb-2">
        <CardTitle className="text-sm font-medium">Active Jobs</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="text-2xl font-bold">{health.activeJobs}</div>
      </CardContent>
    </Card>
    <Card>
      <CardHeader className="pb-2">
        <CardTitle className="text-sm font-medium">Queue Depth</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="text-2xl font-bold">{health.queueDepth}</div>
      </CardContent>
    </Card>
    <Card>
      <CardHeader className="pb-2">
        <CardTitle className="text-sm font-medium">Error Rate (24h)</CardTitle>
      </CardHeader>
      <CardContent>
        <div className={cn(
          "text-2xl font-bold",
          health.errorRate > 5 && "text-destructive"
        )}>
          {health.errorRate.toFixed(1)}%
        </div>
        {health.errorRate > 5 && (
          <Badge variant="destructive" className="mt-1">Warning</Badge>
        )}
      </CardContent>
    </Card>
    <Card>
      <CardHeader className="pb-2">
        <CardTitle className="text-sm font-medium">Database Size</CardTitle>
      </CardHeader>
      <CardContent>
        <div className="text-2xl font-bold">{formatBytes(health.dbSize)}</div>
      </CardContent>
    </Card>
  </div>

  {/* Recent Errors */}
  {health.errorRate > 5 && (
    <Card>
      <CardHeader>
        <CardTitle className="flex items-center gap-2">
          <AlertTriangle className="h-5 w-5 text-destructive" />
          Recent Errors
        </CardTitle>
      </CardHeader>
      <CardContent>
        <Table>
          <TableHeader>
            <TableRow>
              <TableHead>Time</TableHead>
              <TableHead>Type</TableHead>
              <TableHead>Count</TableHead>
              <TableHead>Message</TableHead>
            </TableRow>
          </TableHeader>
          <TableBody>
            {health.recentErrors.map((err, i) => (
              <TableRow key={i}>
                <TableCell>{formatDateTime(err.timestamp)}</TableCell>
                <TableCell><Badge variant="destructive">{err.type}</Badge></TableCell>
                <TableCell>{err.count}</TableCell>
                <TableCell className="max-w-[400px] truncate">{err.message}</TableCell>
              </TableRow>
            ))}
          </TableBody>
        </Table>
      </CardContent>
    </Card>
  )}
</div>
```

---

## 5. Form Specifications

### Login Form

**Location:** `/login`  
**Endpoint:** POST `/api/auth/login`

| Field | Component | Required | Validation | Default |
|-------|-----------|----------|------------|---------|
| email | Input type="email" | Yes | email format, max 255 | "" |
| password | Input type="password" | Yes | min 1 | "" |

**Submission:**
- Success: Store tokens, redirect to `/dashboard`
- INVALID_CREDENTIALS: Toast "Invalid email or password"
- RATE_LIMIT_EXCEEDED: Disable button, show countdown

---

### Accept Invitation Form

**Location:** `/invite/:token`  
**Endpoint:** POST `/api/invitations/:token/accept`

| Field | Component | Required | Validation | Default |
|-------|-----------|----------|------------|---------|
| name | Input | Yes | min 1, max 255 | "" |
| password | Input type="password" | Yes | min 8, uppercase, lowercase, number | "" |

**Submission:**
- Success: Store tokens, redirect to `/dashboard`, toast "Welcome to Foundry!"
- INVITATION_EXPIRED: Show expired message
- INVITATION_ALREADY_ACCEPTED: Redirect to login with message

---

### Create Project Form

**Location:** `/projects` (dialog)  
**Endpoint:** POST `/api/projects`

| Field | Component | Required | Validation | Default |
|-------|-----------|----------|------------|---------|
| name | Input | Yes | min 1, max 100 | "" |
| description | Textarea | No | max 1000 | "" |

**Submission:**
- Success: Toast "Project created", redirect to `/projects/:id/sources`
- DUPLICATE_NAME: Field error "A project with this name already exists"

---

### Teamwork Desk Connection Form

**Location:** Project Sources (dialog)  
**Endpoint:** POST `/api/projects/:projectId/sources/teamwork`

| Field | Component | Required | Validation | Default |
|-------|-----------|----------|------------|---------|
| name | Input | Yes | max 100 | "" |
| subdomain | Input | Yes | min 1 | "" |
| apiKey | Input type="password" | Yes | min 1 | "" |
| filters.dateStart | DatePicker | No | valid date | null |
| filters.dateEnd | DatePicker | No | valid date, > dateStart | null |
| filters.statuses | MultiSelect | No | - | [] |
| filters.includeInternalNotes | Checkbox | No | - | false |

**Pre-submission:** Test connection required
**Submission:**
- Success: Toast "Source connected", close dialog, refresh sources
- CONNECTION_FAILED: Toast with specific error message

---

### Invite Member Form

**Location:** `/team` (dialog)  
**Endpoint:** POST `/api/invitations`

| Field | Component | Required | Validation | Default |
|-------|-----------|----------|------------|---------|
| email | Input type="email" | Yes | email format, max 255 | "" |
| role | Select | Yes | viewer/editor/admin | "viewer" |

**Submission:**
- Success: Toast "Invitation sent", close dialog, refresh invitations
- DUPLICATE_EMAIL: Toast "An invitation has already been sent to this email"

---

### Generate Export Form

**Location:** Project Exports  
**Endpoint:** POST `/api/jobs/:jobId/exports`

| Field | Component | Required | Validation | Default |
|-------|-----------|----------|------------|---------|
| format | RadioGroup | Yes | conversational_jsonl/qa_pairs/raw_json | "conversational_jsonl" |
| options.systemPrompt | Textarea | No | max 2000 | "" |
| options.includeMetadata | Checkbox | No | - | false |

**Submission:**
- Success: Toast "Export generated", refresh exports
- PROCESSING_FAILED: Toast with error

---

## 6. Error Handling

### Error Code to UI Mapping

| Error Code | HTTP | User Message | UI Component | Recovery Action |
|------------|------|--------------|--------------|-----------------|
| VALIDATION_ERROR | 400 | Field-specific messages | Form field errors | Fix and retry |
| INVALID_ID | 400 | "Invalid request" | Toast | Redirect to list |
| INVALID_FILE_TYPE | 400 | "Please upload CSV, Excel, or JSON files" | File upload error | Select valid file |
| FILE_TOO_LARGE | 400 | "File exceeds 50MB limit" | File upload error | Split file |
| UNAUTHORIZED | 401 | "Please log in to continue" | Toast + redirect | Redirect to /login |
| TOKEN_EXPIRED | 401 | "Your session has expired" | Toast + redirect | Redirect to /login |
| INVALID_CREDENTIALS | 401 | "Invalid email or password" | Toast | Retry |
| FORBIDDEN | 403 | "You don't have permission" | Alert | Contact admin |
| INSUFFICIENT_PERMISSIONS | 403 | "You don't have permission for this action" | Toast | None |
| ORGANIZATION_DISABLED | 403 | "Your organization has been disabled" | Alert | Contact support |
| NOT_FOUND | 404 | "Item not found" | Empty state | Back button |
| PROJECT_NOT_FOUND | 404 | "Project not found" | Empty state | Back to projects |
| DUPLICATE_EMAIL | 409 | "An invitation already exists for this email" | Toast | None |
| DUPLICATE_NAME | 409 | "This name is already taken" | Field error | Choose different name |
| INVITATION_EXPIRED | 422 | "This invitation has expired" | Error page | Request new invitation |
| JOB_NOT_CANCELLABLE | 422 | "This job cannot be cancelled" | Toast | None |
| EXPORT_EXPIRED | 422 | "This export has expired" | Badge + disabled | Generate new export |
| CONNECTION_FAILED | 422 | "Connection failed: {details}" | Toast | Check credentials |
| RATE_LIMIT_EXCEEDED | 429 | "Too many requests. Try again in {seconds}s" | Toast + countdown | Wait and retry |
| INTERNAL_ERROR | 500 | "Something went wrong. Please try again." | Toast | Retry button |
| PROCESSING_FAILED | 500 | "Processing failed: {error}" | Toast + details | View job details |

### Rate Limit UI Pattern

```typescript
// hooks/use-rate-limit.ts
export function useRateLimit() {
  const [retryAfter, setRetryAfter] = useState<number | null>(null);

  useEffect(() => {
    if (retryAfter && retryAfter > 0) {
      const timer = setTimeout(() => setRetryAfter(retryAfter - 1), 1000);
      return () => clearTimeout(timer);
    }
  }, [retryAfter]);

  const handleRateLimitError = (error: ApiError) => {
    if (error.code === 'RATE_LIMIT_EXCEEDED') {
      const resetTime = parseInt(error.headers?.['x-ratelimit-reset'] || '60', 10);
      const waitSeconds = Math.max(0, resetTime - Math.floor(Date.now() / 1000));
      setRetryAfter(waitSeconds || 60);
      
      toast({
        variant: "destructive",
        title: "Too many requests",
        description: `Please wait ${waitSeconds} seconds before trying again.`,
      });
      
      return true;
    }
    return false;
  };

  return { retryAfter, isRateLimited: retryAfter !== null && retryAfter > 0, handleRateLimitError };
}

// Usage in form
const { retryAfter, isRateLimited, handleRateLimitError } = useRateLimit();

<Button disabled={isSubmitting || isRateLimited}>
  {isRateLimited ? `Wait ${retryAfter}s` : 'Submit'}
</Button>
```

### Session Expiry Handling

```typescript
// lib/api.ts
const api = axios.create({ baseURL: '/api' });

api.interceptors.response.use(
  (response) => response,
  async (error) => {
    const originalRequest = error.config;
    
    // Handle token expiry with refresh
    if (error.response?.status === 401 && !originalRequest._retry) {
      originalRequest._retry = true;
      
      try {
        const { data } = await api.post('/auth/refresh');
        setAccessToken(data.accessToken);
        originalRequest.headers.Authorization = `Bearer ${data.accessToken}`;
        return api(originalRequest);
      } catch (refreshError) {
        // Refresh failed - redirect to login
        clearAuthState();
        const returnTo = encodeURIComponent(window.location.pathname);
        window.location.href = `/login?returnTo=${returnTo}`;
      }
    }
    
    // Handle organization disabled
    if (error.response?.data?.error?.code === 'ORGANIZATION_DISABLED') {
      clearAuthState();
      window.location.href = '/login?error=org_disabled';
    }
    
    return Promise.reject(error);
  }
);
```

### Global Error Handler

```typescript
// components/error-boundary.tsx
export function ErrorBoundary({ children }: { children: React.ReactNode }) {
  return (
    <ReactErrorBoundary
      fallbackRender={({ error, resetErrorBoundary }) => (
        <div className="min-h-screen flex items-center justify-center p-6">
          <Card className="max-w-md">
            <CardHeader>
              <CardTitle className="flex items-center gap-2">
                <AlertTriangle className="h-5 w-5 text-destructive" />
                Something went wrong
              </CardTitle>
            </CardHeader>
            <CardContent>
              <p className="text-muted-foreground mb-4">
                An unexpected error occurred. Please try again.
              </p>
              <div className="flex gap-2">
                <Button onClick={resetErrorBoundary}>Try Again</Button>
                <Button variant="outline" onClick={() => window.location.href = '/'}>
                  Go Home
                </Button>
              </div>
            </CardContent>
          </Card>
        </div>
      )}
    >
      {children}
    </ReactErrorBoundary>
  );
}
```

---

## 7. Loading & Empty States

### Loading Patterns

| Context | Pattern | Implementation |
|---------|---------|----------------|
| Page load | Skeleton matching content shape | `<Skeleton className="h-[200px]" />` |
| Table load | Skeleton rows | `<TableSkeleton rows={5} columns={4} />` |
| Card grid | Skeleton cards | `<CardSkeleton />` repeated |
| Button action | Button disabled + spinner | `<Loader2 className="animate-spin" />` |
| Form submit | Button loading state | Same as above |
| Background fetch | No indicator | TanStack Query handles silently |
| Long operation | Progress bar | `<Progress value={percentage} />` |

### Skeleton Components

```tsx
// components/skeletons.tsx
export function CardSkeleton() {
  return (
    <Card>
      <CardHeader>
        <Skeleton className="h-6 w-3/4" />
        <Skeleton className="h-4 w-1/2" />
      </CardHeader>
      <CardContent>
        <Skeleton className="h-4 w-full mb-2" />
        <Skeleton className="h-4 w-2/3" />
      </CardContent>
    </Card>
  );
}

export function TableSkeleton({ rows = 5, columns = 4 }: { rows?: number; columns?: number }) {
  return (
    <Table>
      <TableHeader>
        <TableRow>
          {Array.from({ length: columns }).map((_, i) => (
            <TableHead key={i}><Skeleton className="h-4 w-24" /></TableHead>
          ))}
        </TableRow>
      </TableHeader>
      <TableBody>
        {Array.from({ length: rows }).map((_, i) => (
          <TableRow key={i}>
            {Array.from({ length: columns }).map((_, j) => (
              <TableCell key={j}><Skeleton className="h-4 w-full" /></TableCell>
            ))}
          </TableRow>
        ))}
      </TableBody>
    </Table>
  );
}
```

### Empty State Template

```tsx
interface EmptyStateProps {
  icon: LucideIcon;
  title: string;
  description: string;
  action?: {
    label: string;
    onClick: () => void;
  };
}

export function EmptyState({ icon: Icon, title, description, action }: EmptyStateProps) {
  return (
    <Card className="flex flex-col items-center justify-center p-12 text-center">
      <div className="rounded-full bg-muted p-4 mb-4">
        <Icon className="h-8 w-8 text-muted-foreground" />
      </div>
      <CardTitle className="mb-2">{title}</CardTitle>
      <CardDescription className="mb-6 max-w-md">{description}</CardDescription>
      {action && (
        <Button onClick={action.onClick}>{action.label}</Button>
      )}
    </Card>
  );
}

// Usage examples
<EmptyState
  icon={FolderKanban}
  title="No projects yet"
  description="Create your first project to start transforming data"
  action={{ label: "Create Project", onClick: () => setShowCreateDialog(true) }}
/>

<EmptyState
  icon={Database}
  title="No data sources"
  description="Add a file upload or connect an API to get started"
  action={{ label: "Add Source", onClick: () => setShowAddSourceMenu(true) }}
/>

<EmptyState
  icon={Search}
  title="No results found"
  description="Try adjusting your search or filters"
/>
```

---

## 8. Accessibility Specifications

### Focus Management

| Scenario | Behavior |
|----------|----------|
| Dialog open | Focus first focusable element (usually close button or first input) |
| Dialog close | Return focus to trigger element |
| Form error | Focus first invalid field |
| Route change | Focus main content heading or skip to main |
| Toast appear | Announce to screen reader, don't steal focus |
| Dropdown open | Focus first item |

### Keyboard Shortcuts

| Key | Action | Context |
|-----|--------|---------|
| Escape | Close modal/dropdown/popover | Overlays |
| Enter | Submit form / Activate button | Forms, Buttons |
| Tab | Move focus forward | Global |
| Shift+Tab | Move focus backward | Global |
| Arrow keys | Navigate within select/dropdown | Menus |
| Space | Toggle checkbox/switch, activate button | Interactive elements |

### ARIA Requirements

| Component | ARIA Requirement |
|-----------|-----------------|
| Icon buttons | `aria-label` describing action |
| Dialogs | `DialogTitle` required, `DialogDescription` recommended |
| Alerts | `role="alert"` (automatic with Alert component) |
| Loading states | `aria-busy="true"` on loading container |
| Progress bars | `aria-valuenow`, `aria-valuemin`, `aria-valuemax` |
| Tabs | Proper tab panel association (automatic with Tabs component) |
| Forms | Labels associated with inputs, error messages linked via `aria-describedby` |
| Tables | Proper header associations |

### Screen Reader Announcements

```tsx
// Live region for status updates
<div aria-live="polite" aria-atomic="true" className="sr-only">
  {statusMessage}
</div>

// Progress announcements (periodic, not every update)
useEffect(() => {
  if (progress % 25 === 0) {
    announce(`Processing ${progress}% complete`);
  }
}, [progress]);
```

---

## 9. Document Validation

### PRD Coverage Check

| User Story ID | Screen(s) | Status |
|---------------|-----------|--------|
| US-AUTH-001 | Invite Dialog, Accept Invitation | ✓ |
| US-AUTH-002 | Login | ✓ |
| US-AUTH-003 | Team Management | ✓ |
| US-AUTH-004 | Team Management | ✓ |
| US-AUTH-005 | Forgot Password, Reset Password | ✓ |
| US-ORG-001 | Admin Organizations | ✓ |
| US-ORG-002 | Project List, Create Project | ✓ |
| US-ORG-003 | Project Settings | ✓ |
| US-FILE-001 | Sources Tab, File Upload | ✓ |
| US-FILE-002 | Sources Tab, File Upload | ✓ |
| US-FILE-003 | Sources Tab, File Upload | ✓ |
| US-API-TD-001 | Sources Tab, Teamwork Dialog | ✓ |
| US-API-TD-002 | Sources Tab, Source Config | ✓ |
| US-API-TD-003 | Sources Tab, Source Config | ✓ |
| US-API-TD-004 | Sources Tab, Preview | ✓ |
| US-API-GHL-001 | Sources Tab, GoHighLevel Dialog | ✓ |
| US-API-GHL-002 | Sources Tab, Source Config | ✓ |
| US-MAP-001 | Mapping Tab | ✓ |
| US-MAP-002 | Mapping Tab | ✓ |
| US-MAP-003 | Mapping Tab, Preview Sheet | ✓ |
| US-DEID-001 | Processing (implicit) | ✓ |
| US-DEID-002 | Processing (implicit) | ✓ |
| US-DEID-003 | Processing (implicit) | ✓ |
| US-DEID-004 | Processing (implicit) | ✓ |
| US-DEID-005 | Processing (implicit) | ✓ |
| US-DEID-006 | Project Settings | ✓ |
| US-FILT-001 | Project Settings | ✓ |
| US-FILT-002 | Project Settings | ✓ |
| US-FILT-003 | Project Settings | ✓ |
| US-PROC-001 | Processing Tab | ✓ |
| US-PROC-002 | Processing Tab | ✓ |
| US-PROC-003 | Processing Tab | ✓ |
| US-EXP-001 | Exports Tab | ✓ |
| US-EXP-002 | Exports Tab | ✓ |
| US-EXP-003 | Exports Tab | ✓ |
| US-AUD-001 | Audit Log | ✓ |
| US-AUD-002 | Audit Log | ✓ |
| US-PLAT-001 | Admin Organizations | ✓ |
| US-PLAT-002 | Admin Health | ✓ |
| US-PLAT-003 | Admin Organizations | ✓ |

### State Completeness Check

| Screen | Loading | Default | Empty | Error |
|--------|---------|---------|-------|-------|
| Login | N/A | ✓ | N/A | ✓ |
| Accept Invitation | ✓ | ✓ | N/A | ✓ |
| Dashboard | ✓ | ✓ | ✓ | ✓ |
| Project List | ✓ | ✓ | ✓ | ✓ |
| Sources Tab | ✓ | ✓ | ✓ | ✓ |
| Mapping Tab | ✓ | ✓ | ✓ | ✓ |
| Processing Tab | ✓ | ✓ | ✓ | ✓ |
| Exports Tab | ✓ | ✓ | ✓ | ✓ |
| Team | ✓ | ✓ | ✓ | ✓ |
| Audit Log | ✓ | ✓ | ✓ | ✓ |
| Admin Orgs | ✓ | ✓ | ✓ | ✓ |
| Admin Health | ✓ | ✓ | N/A | ✓ |

### Error Code Coverage Check

| Error Code | UI Documented | Recovery Documented |
|------------|---------------|---------------------|
| VALIDATION_ERROR | ✓ | ✓ |
| INVALID_ID | ✓ | ✓ |
| INVALID_FILE_TYPE | ✓ | ✓ |
| FILE_TOO_LARGE | ✓ | ✓ |
| UNAUTHORIZED | ✓ | ✓ |
| TOKEN_EXPIRED | ✓ | ✓ |
| INVALID_CREDENTIALS | ✓ | ✓ |
| FORBIDDEN | ✓ | ✓ |
| INSUFFICIENT_PERMISSIONS | ✓ | ✓ |
| ORGANIZATION_DISABLED | ✓ | ✓ |
| NOT_FOUND | ✓ | ✓ |
| PROJECT_NOT_FOUND | ✓ | ✓ |
| DUPLICATE_EMAIL | ✓ | ✓ |
| DUPLICATE_NAME | ✓ | ✓ |
| INVITATION_EXPIRED | ✓ | ✓ |
| JOB_NOT_CANCELLABLE | ✓ | ✓ |
| EXPORT_EXPIRED | ✓ | ✓ |
| CONNECTION_FAILED | ✓ | ✓ |
| RATE_LIMIT_EXCEEDED | ✓ | ✓ |
| INTERNAL_ERROR | ✓ | ✓ |
| PROCESSING_FAILED | ✓ | ✓ |

### Accessibility Checklist

- [x] All interactive elements have focus visible states (`ring-2 ring-ring ring-offset-2`)
- [x] All icon buttons have accessible labels (aria-label or sr-only text)
- [x] All forms use FormLabel components properly associated
- [x] Color contrast meets WCAG AA (4.5:1 normal, 3:1 large) via semantic tokens
- [x] Keyboard navigation works throughout (Radix primitives)
- [x] Focus management handled for dialogs (Radix Dialog)
- [x] Touch targets minimum 44x44px specified for mobile
- [x] Loading states have aria-busy
- [x] Error states announced to screen readers (Toast with role="alert")

### Role Gating Checklist

- [x] Every nav item has role requirements documented
- [x] Every screen has role requirements documented
- [x] No nav links lead to 403 errors (filtered by role)
- [x] Admin sections hidden from non-admins
- [x] Platform admin sections hidden from regular users

---

## 10. Confidence Scores

| Section | Score (1-10) | Notes |
|---------|--------------|-------|
| Screen Coverage | 9 | All PRD screens documented |
| Component Library | 9 | shadcn/ui components specified |
| Form Specifications | 9 | All forms with validation |
| Error Handling | 9 | All API error codes mapped |
| Accessibility | 8 | Core requirements covered, may need refinement |
| Role Gating | 9 | Comprehensive role checks |
| Loading States | 9 | All states documented |
| **Overall** | **9** | Ready for implementation |

---

## 11. Downstream Agent Handoff Brief

### For Agent 6: Implementation Orchestrator

**Component Installation:**

```bash
npx shadcn-ui@latest init
npx shadcn-ui@latest add button card dialog form input label select toast \
  alert-dialog dropdown-menu avatar badge skeleton tabs sheet separator \
  progress table tooltip popover checkbox radio-group switch textarea \
  alert scroll-area command
```

**Peer Dependencies:**

```bash
npm install @radix-ui/react-alert-dialog @radix-ui/react-dialog \
  @radix-ui/react-dropdown-menu @radix-ui/react-label @radix-ui/react-select \
  @radix-ui/react-slot @radix-ui/react-tabs @radix-ui/react-toast \
  @radix-ui/react-progress @radix-ui/react-checkbox @radix-ui/react-radio-group \
  @radix-ui/react-switch @radix-ui/react-popover @radix-ui/react-tooltip \
  @radix-ui/react-scroll-area
npm install lucide-react class-variance-authority clsx tailwind-merge
npm install react-dropzone date-fns
```

**Critical Configuration:**

1. `tailwind.config.ts` must include CSS variable theme
2. `client/src/index.css` must include light/dark mode variables
3. `client/src/lib/utils.ts` must have `cn()` function
4. React Router configured with protected route wrapper

**Error Handling Requirements:**

- Global API interceptor for auth errors (token refresh, redirect on 401)
- Toast component for all feedback
- Rate limit countdown UI for auth endpoints
- Error boundary for unexpected errors

**Implementation Order:**

1. Design system setup (CSS variables, Tailwind config, utils)
2. Auth screens (login, accept invitation, forgot/reset password)
3. Layout components (sidebar nav, header, protected route wrapper)
4. Dashboard
5. Project list and create
6. Project detail tabs (sources, mapping, processing, exports)
7. Team management
8. Settings and audit log
9. Platform admin (if applicable)

---

### For Agent 7: QA & Deployment

**Visual Testing:**

- All screens in light mode
- All screens in dark mode (if implemented)
- All responsive breakpoints (md: 768px, lg: 1024px, xl: 1280px)
- All form states (pristine, error, submitting, success)
- All loading states (skeletons, spinners)
- All empty states

**Accessibility Testing Checklist:**

- [ ] Tab through entire app - all elements reachable
- [ ] No focus traps (except modals)
- [ ] All images have alt text
- [ ] All icon buttons have labels
- [ ] Color contrast passes (use axe-core)
- [ ] Screen reader can navigate all content
- [ ] Form errors announced to screen reader
- [ ] Dialogs trap focus correctly
- [ ] Escape closes modals

**Error Scenario Testing:**

| Scenario | Expected Behavior |
|----------|-------------------|
| Token expiry mid-session | Redirect to login with return URL |
| Rate limit on login | Countdown displayed, button disabled |
| 403 on nav click | Error shown (indicates nav gating bug) |
| Network error | Retry option shown |
| Validation error | Fields highlighted with messages |
| Invalid URL parameter | 400 error with redirect |
| Not found resource | 404 with back button |

**Browser Testing:**

- Chrome (latest)
- Firefox (latest)
- Safari (latest)
- Mobile Safari (tablet)
- Mobile Chrome (tablet)

**Critical User Flows:**

1. **First-run flow:** Login → Dashboard (empty) → Create Project → Add Source (file upload) → Configure Mapping → Run Processing → Generate Export → Download
2. **Team invite flow:** Admin → Team → Invite → Email sent → Accept → Set password → Dashboard
3. **API connection flow:** Project → Add Source → Teamwork Desk → Enter credentials → Test → Connect → Preview

---

**Document Status: COMPLETE**

---

*Document End*
